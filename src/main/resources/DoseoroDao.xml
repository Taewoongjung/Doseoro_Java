<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.myproject.doseoro.global.dao.DoseoroDao">

    <!--@@@@@@@@@@@@@@@@   identity     @@@@@@@@@@@@@@@@@-->
    <select id="findUserByEmail" resultType="AccessUserVO" parameterType="String">
        SELECT
            id AS id,
            email AS email,
            nick_name AS nickName
        FROM t_identity
        WHERE email = #{email}
    </select>

    <select id="findUserById" resultType="IdentityMyPageVO" parameterType="String">
        SELECT
            id AS id,
            email AS email,
            name AS name,
            nick_name AS nickName,
            phone AS phone,
            liked AS liked,
            location AS location,
            dong AS dong,
            si AS si,
            dou AS dou,
            provider AS provider,
            sns_id AS snsId,
            updated_at AS updatedAt
        FROM t_identity
        WHERE id = #{id}
    </select>

    <select id="existEmail" resultType="Boolean" parameterType="String">
        SELECT distinct * FROM t_identity WHERE email = #{email}
    </select>

    <select id="findUser" resultType="SignUpVO" parameterType="String">
        SELECT
            id AS id,
            email AS email,
            name AS name,
            nick_name AS nickName,
            phone AS phoneNumber,
            forgot_pw_question AS question,
            forgot_pw_answer AS answerForQuestion
        FROM t_identity
        WHERE email = #{email}
    </select>

    <!--    로그인     -->
    <select id="loginCheck" resultType="LogInVO" parameterType="String">
        SELECT
            id AS id,
            password AS password,
            email AS email,
            name AS name,
            nick_name AS nickName,
            phone AS phone,
            forgot_pw_question AS forgotPwQuestion,
            forgot_pw_answer AS forgotPwAnswer
        FROM t_identity
        WHERE email = #{email}
    </select>

    <!--    회원가입     -->
    <insert id="signUp" parameterType="SignUpVO">
        INSERT INTO t_identity(id, email, password, name, nick_name, phone, forgot_pw_question, forgot_pw_answer)
        VALUES(#{id}, #{email}, #{password}, #{name}, #{nickName}, #{phoneNumber}, #{question}, #{answerForQuestion})
    </insert>
    <!--@@@@@@@@@@@@@@@@   identity     @@@@@@@@@@@@@@@@@-->







    <!--@@@@@@@@@@@@@@@@   book     @@@@@@@@@@@@@@@@@-->

    <!--    책 등록    -->
    <insert id="registerBook" parameterType="RegisterBookVO">
        INSERT INTO t_book
            (
                 id,
                 post_message,
                 title,
                 price,
                 author,
                 publisher,
                 category,
                 state,
                 trade_method,
                 img,
                 about,
                 owner_id
             )
        VALUES(
                   #{vo.id},
                   #{vo.postmessage},
                   #{vo.title},
                   #{vo.price},
                   #{vo.author},
                   #{vo.publisher},
                   #{vo.checkCategory, typeHandler=com.myproject.doseoro.global.util.JsonTypeHandler},
                   #{vo.checkState, typeHandler=com.myproject.doseoro.global.util.JsonTypeHandler},
                   #{vo.dealRoot},
                   #{vo.images, typeHandler=com.myproject.doseoro.global.util.JsonTypeHandler},
                   #{vo.about},
                   #{vo.ownerId}
               );
    </insert>

    <!--    책의 id로 책 찾기    -->
    <resultMap id="BookVO" type="com.myproject.doseoro.packages.book.vo.BookVO">
        <result property="id" column="id"></result>
        <result property="postMessage" column="post_message"></result>
        <result property="title" column="title"></result>
        <result property="price" column="price"></result>
        <result property="author" column="author"></result>
        <result property="publisher" column="publisher"></result>
        <result property="category" column="category" typeHandler="com.myproject.doseoro.global.util.JsonTypeHandler"></result>
        <result property="state" column="state" typeHandler="com.myproject.doseoro.global.util.JsonTypeHandler"></result>
        <result property="tradeMethod" column="trade_method"></result>
        <result property="images" column="img" typeHandler="com.myproject.doseoro.global.util.JsonTypeHandler"></result>
        <result property="like" column="like"></result>
        <result property="sold" column="sold"></result>
        <result property="about" column="about"></result>
        <result property="OwnerId" column="owner_id"></result>
    </resultMap>
    <select id="findBookByBookId" resultMap="BookVO" parameterType="String">
        SELECT
            id,
            post_message,
            title,
            price,
            author,
            publisher,
            category,
            state,
            trade_method,
            img,
            like_count,
            sold,
            about,
            owner_id
        FROM t_book
        where id = #{bookId}
    </select>

    <!--    홈 화면에 전시할 책 5가지 찾기   -->
    <resultMap id="HomeDisplayedBookVO" type="com.myproject.doseoro.packages.book.vo.HomeDisplayedBookVO">
        <result property="title" column="title"></result>
        <result property="about" column="about"></result>
        <result property="price" column="price"></result>
        <result property="images" column="img" typeHandler="com.myproject.doseoro.global.util.JsonTypeHandler"></result>
    </resultMap>
    <select id="findHomeDisplayedBooks" resultMap="HomeDisplayedBookVO">
        SELECT
            id,
            title,
            about,
            price,
            img
        FROM t_book
        ORDER BY createdAt
        DESC  LIMIT 5
    </select>

    <!--    판매중인 책 가져오기    -->
    <resultMap id="FindAllBooksVO" type="com.myproject.doseoro.packages.book.vo.FindAllBooksVO">
        <result property="id" column="id"></result>
        <result property="postMessage" column="post_message"></result>
        <result property="title" column="title"></result>
        <result property="price" column="price"></result>
        <result property="author" column="author"></result>
        <result property="publisher" column="publisher"></result>
        <result property="category" column="category" typeHandler="com.myproject.doseoro.global.util.JsonTypeHandler"></result>
        <result property="state" column="state" typeHandler="com.myproject.doseoro.global.util.JsonTypeHandler"></result>
        <result property="tradeMethod" column="trade_method"></result>
        <result property="images" column="img" typeHandler="com.myproject.doseoro.global.util.JsonTypeHandler"></result>
        <result property="like" column="like"></result>
        <result property="sold" column="sold"></result>
        <result property="about" column="about"></result>
        <result property="OwnerId" column="owner_id"></result>
    </resultMap>
    <select id="findAllBooksForSaleBoard" resultMap="FindAllBooksVO">
        SELECT
            id,
            post_message,
            title,
            price,
            author,
            publisher,
            category,
            state,
            trade_method,
            img,
            like_count,
            sold,
            about,
            owner_id
        FROM t_book
        WHERE sold != 1 AND price != "null"
    </select>

    <!--@@@@@@@@@@@@@@@@   book     @@@@@@@@@@@@@@@@@-->

</mapper>
